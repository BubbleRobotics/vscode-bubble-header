name: Extension Build

# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

on:
  push:
    branches: [ "master" ]
    # Publish semver tags as releases.
    tags: [ 'v*.*.*' ]
  pull_request:
    branches: [ "master" ]
  release:
    types: [ created ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run linter
      run: npm run lint
      continue-on-error: true
    
    - name: Run tests
      run: npm test
      continue-on-error: true
    
    - name: Build extension
      run: npm run compile
    
    - name: Package extension
      run: npx vsce package
    
    - name: Upload VSIX artifact
      uses: actions/upload-artifact@v4
      with:
        name: br-header-vscode-extension
        path: "*.vsix"
        retention-days: 30
# jobs:
#   build:
#     runs-on: windows-latest
#     steps:

#     - name: Checkout the code
#       uses: actions/checkout@v5

#     - name: Add nuget to PATH
#       uses: nuget/setup-nuget@v2

#     - name: Add msbuild to PATH
#       uses: microsoft/setup-msbuild@v1.1.3

#     - name: Restore
#       run: nuget restore

#     - name: Build
#       run: msbuild /p:configuration=Release /p:DeployExtension=false /p:ZipPackageCompressionLevel=normal

#     - uses: actions/upload-artifact@v5
#       with:
#         name: BR-header.vsix
#         path: BR-header\bin\Release\BR-header.vsix